; PlatformIO Project Configuration File
;
; JSense Board ESP32 Firmware
; Build configuration for all board variants (JBOARD-2, JBOARD-4, JBOARD-8, JBOARD-16)
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[platformio]
default_envs = jboard-16

; Common settings shared across all environments
[common]
build_flags =
    -DCORE_DEBUG_LEVEL=3
    -DASYNCWEBSERVER_REGEX=1

lib_ignore =
    WebServer

lib_deps =
    ; Core Web Server
    https://github.com/me-no-dev/ESPAsyncWebServer.git
    https://github.com/me-no-dev/AsyncTCP.git
    bblanchon/ArduinoJson @ ^6.21.3
    
    ; LED Control
    fastled/FastLED @ ^3.6.0
    
    ; Hardware (RTC, OLED)
    adafruit/Adafruit GFX Library @ ^1.11.9
    adafruit/Adafruit SSD1306 @ ^2.5.9
    adafruit/RTClib @ ^2.1.3
    
    ; DNS Server for Captive Portal
    DNSServer @ ^1.1.0

; Default environment - JBOARD-16 (full-featured reference board)
[env:jboard-16]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino

; ESP32-S3 N16R8 Configuration (16MB Flash, 8MB Octal PSRAM)
board_build.flash_mode = qio
board_build.flash_size = 16MB
board_build.psram_type = opi
board_build.arduino.memory_type = qio_opi
board_upload.flash_size = 16MB
board_build.partitions = partitions.csv
board_build.filesystem = littlefs

build_flags =
    ${common.build_flags}
    -DBOARD_JBOARD_16
    -DBOARD_HAS_PSRAM
    -DCONFIG_SPIRAM_SUPPORT=1
    -DCONFIG_SPIRAM_USE_MALLOC=1

lib_ignore = WebServer

lib_deps = ${common.lib_deps}

monitor_speed = 115200
upload_speed = 921600
upload_flags = 
    --before=default_reset
    --after=hard_reset

; Board variant environments
[env:jboard-8]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino

build_flags =
    ${common.build_flags}
    -DBOARD_JBOARD_8

lib_deps = ${common.lib_deps}

monitor_speed = 115200
upload_speed = 921600

[env:jboard-4]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino

build_flags =
    ${common.build_flags}
    -DBOARD_JBOARD_4

lib_deps = ${common.lib_deps}

monitor_speed = 115200
upload_speed = 921600

[env:jboard-2]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino

build_flags =
    ${common.build_flags}
    -DBOARD_JBOARD_2

lib_deps = ${common.lib_deps}

monitor_speed = 115200
upload_speed = 921600
